<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>查询和读写文件 - 读书笔记</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">读书笔记</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../node.js高级编程/index.html" class="breadcrumb-item">node.js高级编程</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../node.js高级编程/5.查询和读写文件.html" class="breadcrumb-item">查询和读写文件</a></div><h1 class="article-title">查询和读写文件</h1><div class="article"><h2 id="处理文件路径">处理文件路径 <a class="markdownIt-Anchor" href="#处理文件路径">#</a></h2><blockquote><p>文件路径表示具体文件，它分为绝对路径和相对路径。Node中使用字符串来处理路径，path模块可以规范化、连接和解析路径,还可以将绝对路径转化为相对路径、提取路径的组成部分以及确定路径是否存在。</p></blockquote><h3 id="规范化路径">规范化路径 <a class="markdownIt-Anchor" href="#规范化路径">#</a></h3><p>使用path模块中的normalize()函数来规范化路径字符串。</p><figure><img src="http://upcxyyz.cn/path1.png" alt="例"><figcaption>例</figcaption></figure><h3 id="连接路径">连接路径 <a class="markdownIt-Anchor" href="#连接路径">#</a></h3><p>path.join()函数,可以连接任意多个路径字符串,同时也对路径进行了规范化。</p><figure><img src="http://upcxyyz.cn/path2.png" alt="例"><figcaption>例</figcaption></figure><h3 id="解析路径">解析路径 <a class="markdownIt-Anchor" href="#解析路径">#</a></h3><p>可以使用path.resolve()将多个路径解析成一个规范化的绝对路径。</p><figure><img src="http://upcxyyz.cn/path3.png" alt="例"><figcaption>例</figcaption></figure><p>不会利用底层文件系统来判断路径是否存在，而只是对路径字符串处理。解析路径不是绝对路径，函数会将当前工作目录附加到解析结果之前。</p><h3 id="查找两个绝对路径之间的相对路径">查找两个绝对路径之间的相对路径 <a class="markdownIt-Anchor" href="#查找两个绝对路径之间的相对路径">#</a></h3><p>path.realtive()，可以确定如何从一个绝对路径跳转到另一个绝对路径。</p><figure><img src="http://upcxyyz.cn/path4.png" alt="例"><figcaption>例</figcaption></figure><h3 id="提取路径的组成部分">提取路径的组成部分 <a class="markdownIt-Anchor" href="#提取路径的组成部分">#</a></h3><p>path.dirname(),path.basename()</p><figure><img src="http://upcxyyz.cn/path5.png" alt="例"><figcaption>例</figcaption></figure><h2 id="fs模块">fs模块 <a class="markdownIt-Anchor" href="#fs模块">#</a></h2><h3 id="查询文件的统计信息">查询文件的统计信息 <a class="markdownIt-Anchor" href="#查询文件的统计信息">#</a></h3><p>fs.stat()</p><figure><img src="http://upcxyyz.cn/fs1.png" alt="例"><figcaption>例</figcaption></figure><p>fs.stat()函数调用会将stats类的一个实例传递给其回调函数，该实例可以调用一下函数：<br><img src="http://upcxyyz.cn/QU@@%25JTON5_L%28ZX~49EJ~B0.png" alt="例"></p><h2 id="打开文件">打开文件 <a class="markdownIt-Anchor" href="#打开文件">#</a></h2><pre class="hljs"><code><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
fs.open(<span class="hljs-string">'path/file'</span>,<span class="hljs-string">'r'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err,fd</span>)</span>{
    <span class="hljs-comment">//获取文件描述符fd</span>
})
</code></pre><p>第二个参数是标志位，表明文件以何种模式打开。</p><figure><img src="http://upcxyyz.cn/%6081Q6%7B3U7T%5B%5B%29D54W~7XEB3.png" alt="例"><figcaption>例</figcaption></figure><h2 id="读取文件">读取文件 <a class="markdownIt-Anchor" href="#读取文件">#</a></h2><p>fs.read(),文件一旦打开就可以进行读取，读取之前创建一个缓冲区放置数据。</p><h2 id="写入文件">写入文件 <a class="markdownIt-Anchor" href="#写入文件">#</a></h2><p>fs.write() 传递一个包含数据的缓冲区，可以向一个已经打开的文件中写入数据。</p><h2 id="关闭文件">关闭文件 <a class="markdownIt-Anchor" href="#关闭文件">#</a></h2><p>fs.close()</p><pre class="hljs"><code><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">writeBuffer,callback</span>)</span>{
    fs.open(<span class="hljs-string">'config.js'</span>,<span class="hljs-string">'a'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">opened</span>(<span class="hljs-params">err,fd</span>)</span>{
        <span class="hljs-keyword">if</span>(err){<span class="hljs-keyword">return</span> callback(err)}
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notifyError</span>(<span class="hljs-params">err</span>)</span>{
            fs.close(fd,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                callback(err);
            })
        }
        <span class="hljs-keyword">var</span> bufferOffset = <span class="hljs-number">0</span>,
        bufferLength = writeBuffer.length,
        filePosition = <span class="hljs-literal">null</span>;
        fs.write(fd,writeBuffer,bufferOffset,bufferLength,filePosition,<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrote</span>(<span class="hljs-params">err,written</span>)</span>{
            <span class="hljs-keyword">if</span>(err){<span class="hljs-keyword">return</span> notifyError(err)}
            fs.close(fd,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                callback(err)
            })
        })
    })
}
log(
    <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'writing this string:hello newman'</span>),<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span>(<span class="hljs-params">err</span>)</span>{
        <span class="hljs-keyword">if</span>(err){
            closole.log(<span class="hljs-string">"error:"</span>,err)
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no err'</span>)
    }
)
</code></pre><figure><img src="http://upcxyyz.cn/fs2.png" alt="结果"><figcaption>结果</figcaption></figure></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../node.js高级编程/4.使用事件发射器简化事件绑定.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="../你不知道的JavaScript/index.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.14</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../node.js高级编程/index.html">node.js高级编程</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../node.js高级编程/1.Node简介.html">Node简介</a></li><li class="chapter-item"><a href="../node.js高级编程/2.Node核心API基础.html">Node核心API基础</a></li><li class="chapter-item"><a href="../node.js高级编程/3.应用缓冲区处理、编码和解码二进制数据.html">应用缓冲区处理、编码和解码二进制数据</a></li><li class="chapter-item"><a href="../node.js高级编程/4.使用事件发射器简化事件绑定.html">使用事件发射器简化事件绑定</a></li><li class="chapter-item chapter-item-current"><a href="../node.js高级编程/5.查询和读写文件.html">查询和读写文件</a></li></ul><li class="chapter-item"><a href="../你不知道的JavaScript/index.html">你不知道的JavaScript</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../你不知道的JavaScript/1.作用域和闭包.html">作用域和闭包</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/2.词法作用域.html">词法作用域</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/3.函数作用域和块作用域.html">函数作用域和块作用域</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/4.提升.html">提升</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/5.作用域闭包.html">作用域闭包</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/6.作用域补充.html">作用域补充</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/7.关于this.html">关于this</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/8.this全面解析.html">this全面解析</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/9.对象.html">对象</a></li></ul></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"node.js高级编程/5.查询和读写文件.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84">处理文件路径</a>\n<ul>\n<li><a href="#%E8%A7%84%E8%8C%83%E5%8C%96%E8%B7%AF%E5%BE%84">规范化路径</a></li>\n<li><a href="#%E8%BF%9E%E6%8E%A5%E8%B7%AF%E5%BE%84">连接路径</a></li>\n<li><a href="#%E8%A7%A3%E6%9E%90%E8%B7%AF%E5%BE%84">解析路径</a></li>\n<li><a href="#%E6%9F%A5%E6%89%BE%E4%B8%A4%E4%B8%AA%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E4%B9%8B%E9%97%B4%E7%9A%84%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84">查找两个绝对路径之间的相对路径</a></li>\n<li><a href="#%E6%8F%90%E5%8F%96%E8%B7%AF%E5%BE%84%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86">提取路径的组成部分</a></li>\n</ul>\n</li>\n<li><a href="#fs%E6%A8%A1%E5%9D%97">fs模块</a>\n<ul>\n<li><a href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF">查询文件的统计信息</a></li>\n</ul>\n</li>\n<li><a href="#%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6">打开文件</a></li>\n<li><a href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">读取文件</a></li>\n<li><a href="#%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6">写入文件</a></li>\n<li><a href="#%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6">关闭文件</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>
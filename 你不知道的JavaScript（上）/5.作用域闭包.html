<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>作用域闭包 - 读书笔记</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">读书笔记</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../你不知道的JavaScript/index.html" class="breadcrumb-item">你不知道的JavaScript</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../你不知道的JavaScript/5.作用域闭包.html" class="breadcrumb-item">作用域闭包</a></div><h1 class="article-title">作用域闭包</h1><div class="article"><blockquote><p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p></blockquote><pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">2</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log( a );
    }
    <span class="hljs-keyword">return</span> bar;
  }
<span class="hljs-keyword">var</span> baz = foo();
baz(); <span class="hljs-comment">// 2</span>
</code></pre><p>由于bar() 所声明的位置，它拥有涵盖 foo() 内部作用域的闭包，使得该作用域能够一直存活，以供 bar()在之后任何时间进行引用。bar() 依然持有对该作用域的引用，而这个引用就叫作闭包。<strong>该引用(闭包) = bar() + bar所能访问到的自由变量</strong></p><blockquote><p><strong>闭包 = 函数 + 函数能够访问的自由变量</strong></p></blockquote><h2 id="循环和闭包">循环和闭包 <a class="markdownIt-Anchor" href="#循环和闭包">#</a></h2><pre class="hljs"><code><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">5</span>; i++) {
  setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timer</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log( i );
    }, i*<span class="hljs-number">1000</span> );
}
</code></pre><p>延迟函数的回调会在循环结束时才执行，所以每次会输出一个6。</p><pre class="hljs"><code><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">5</span>; i++) {
  (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">j</span>) </span>{
    setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timer</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log( j );
    }, j*<span class="hljs-number">1000</span> );
    })( i );
}
<span class="hljs-comment">//每隔一秒分别输出1,2,3,4,5</span>
</code></pre><p>在迭代内使用 IIFE 会为每个迭代都生成一个新的作用域，使得延迟函数的回调可以将新的作用域封闭在每个迭代内部，每个迭代中都会含有一个具有正确值的变量供我们访问。</p><pre class="hljs"><code><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">5</span>; i++) {
  setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timer</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log( i );
  }, i*<span class="hljs-number">1000</span> );
}
<span class="hljs-comment">//每隔一秒分别输出1,2,3,4,5</span>
</code></pre><p>let 声明将变量i绑定在了for循环块作用域中，每次迭代都会声明，所以每次迭代都会是使用上一个迭代结束时的初始值来初始化变量i。</p><h2 id="模块">模块 <a class="markdownIt-Anchor" href="#模块">#</a></h2><p>模块模式需要具备两个必要条件：</p><ol><li><p>必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。</p></li><li><p>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</p></li></ol><h2 id="小结">小结 <a class="markdownIt-Anchor" href="#小结">#</a></h2><ul><li><p>当函数可以记住并访问所在的词法作用域，即使函数是在当前词法作用域之外执行，这时就产生了闭包。</p></li><li><p>闭包 = 函数 + 函数能够访问的自由变量</p></li><li><p>（1）为创建内部作用域而调用了一个包装函数；（2）包装函数的返回值必须至少包括一个对内部函数的引用，这样就会创建涵盖整个包装函数内部作用域的闭包。</p></li></ul></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../你不知道的JavaScript/4.提升.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="../你不知道的JavaScript/6.作用域补充.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.14</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../node.js高级编程/index.html">node.js高级编程</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../node.js高级编程/1.Node简介.html">Node简介</a></li><li class="chapter-item"><a href="../node.js高级编程/2.Node核心API基础.html">Node核心API基础</a></li><li class="chapter-item"><a href="../node.js高级编程/3.应用缓冲区处理、编码和解码二进制数据.html">应用缓冲区处理、编码和解码二进制数据</a></li><li class="chapter-item"><a href="../node.js高级编程/4.使用事件发射器简化事件绑定.html">使用事件发射器简化事件绑定</a></li><li class="chapter-item"><a href="../node.js高级编程/note5.html">查询和读写文件</a></li></ul><li class="chapter-item"><a href="../你不知道的JavaScript/index.html">你不知道的JavaScript</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../你不知道的JavaScript/1.作用域和闭包.html">作用域和闭包</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/2.词法作用域.html">词法作用域</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/3.函数作用域和块作用域.html">函数作用域和块作用域</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/4.提升.html">提升</a></li><li class="chapter-item chapter-item-current"><a href="../你不知道的JavaScript/5.作用域闭包.html">作用域闭包</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/6.作用域补充.html">作用域补充</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/7.关于this.html">关于this</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/8.this全面解析.html">this全面解析</a></li><li class="chapter-item"><a href="../你不知道的JavaScript/9.对象.html">对象</a></li></ul></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"你不知道的JavaScript/5.作用域闭包.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E5%BE%AA%E7%8E%AF%E5%92%8C%E9%97%AD%E5%8C%85">循环和闭包</a></li>\n<li><a href="#%E6%A8%A1%E5%9D%97">模块</a></li>\n<li><a href="#%E5%B0%8F%E7%BB%93">小结</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>